    <!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.11.5">
    <title>Expug.TokenizerTools – expug v0.4.0</title>
    <link rel="stylesheet" href="dist/app-ddd9717ad9.css" />
    
    <script src="dist/sidebar_items.js"></script>
  </head>
  <body data-type="modules">

    <div class="main">
<button class="sidebar-toggle">
  <i class="icon-menu"></i>
</button>
<section class="sidebar">
  <button class="sidebar-toggle">
    <i class="icon-menu"></i>
  </button>

  
  <a href="readme.html" class="sidebar-projectLink">
    <div class="sidebar-projectDetails">
      <h1 class="sidebar-projectName">
        expug
      </h1>
      <h2 class="sidebar-projectVersion">
        v0.4.0
      </h2>
    </div>
    
  </a>

  <div class="sidebar-search">
    <i class="icon-search"></i>
    <input type="text" class="sidebar-searchInput" placeholder="search" autocomplete="off" />
  </div>

  <ul class="sidebar-listNav">
    <li><a id="extras-list" href="#full-list">Pages</a></li>

    
      <li><a id="modules-list" href="#full-list">Modules</a></li>
    

    
      <li><a id="exceptions-list" href="#full-list">Exceptions</a></li>
    

    
  </ul>

  <ul id="full-list" class="sidebar-fullList"></ul>
  <div class="sidebar-noResults"></div>
</section>

<section class="content">
  <div id="content" class="content-inner">


      <h1>
        <small class="visible-xs">expug v0.4.0</small>
        Expug.TokenizerTools
        
        
          <a href="https://github.com/rstacruz/expug/blob/v0.4.0/lib/expug/tokenizer_tools.ex#L1" title="View Source" class="view-source" rel="help">
            <i class="icon-code"></i>
          </a>
        
      </h1>

      
        <section id="moduledoc" class="docstring">
          <p>Builds tokenizers.</p>
<pre><code class="elixir">defmodule MyTokenizer do
  import Expug.TokenizerTools

  def tokenizer(source)
    run(source, [], &amp;document/1)
  end

  def document(state)
    state
    |&gt; discard(%r/^doctype /, :doctype_prelude)
    |&gt; eat(%r/^[a-z0-9]+/, :doctype_value)
  end
end</code></pre>
<h2>The state</h2>
<p><a href="Expug.TokenizerTools.State.html"><code class="inline">Expug.TokenizerTools.State</code></a> is a struct from the <code class="inline">source</code> and <code class="inline">opts</code> given to <a href="#run/3"><code class="inline">run/3</code></a>.</p>
<pre><code class="elixir">%{ tokens: [], source: &quot;...&quot;, position: 0, options: ... }</code></pre>
<p><a href="#run/3"><code class="inline">run/3</code></a> creates the state and invokes a function you give it.</p>
<pre><code class="elixir">source = &quot;doctype html&quot;
run(source, [], &amp;document/1)</code></pre>
<p><a href="#eat/3"><code class="inline">eat/3</code></a> tries to find the given regexp from the <code class="inline">source</code> at position <code class="inline">pos</code>.
If it matches, it returns a new state: a new token is added (<code class="inline">:open_quote</code> in
this case), and the position <code class="inline">pos</code> is advanced.</p>
<pre><code class="elixir">eat(state, ~r/^&quot;/, :open_quote)</code></pre>
<p>If it fails to match, it’ll throw a <code class="inline">{:parse_error, pos, [:open_quote]}</code>.
Roughly this translates to “parse error in position <em>pos</em>, expected to find
<em>:open_quote</em>”.</p>
<h2>Mixing and matching</h2>
<p><a href="#eat/3"><code class="inline">eat/3</code></a> will normally be wrapped into functions for most token types.</p>
<pre><code class="elixir">def doctype(state)
  state
  |&gt; discard(%r/^doctype/, :doctype_prelude)
  |&gt; whitespace()
  |&gt; eat(%r/^[a-z0-9]+/, :doctype_value)
end

def whitespace(state)
  state
  |&gt; eat(^r/[   ]+, :whitespace, :nil)
end</code></pre>
<p><a href="#one_of/3"><code class="inline">one_of/3</code></a>, <a href="#optional/2"><code class="inline">optional/2</code></a>, <a href="#many_of/2"><code class="inline">many_of/2</code></a> can then be used to compose these functions.</p>
<pre><code class="elixir">state
|&gt; one_of([ &amp;doctype/1, &amp;foobar/1 ])
|&gt; optional(&amp;doctype/1)
|&gt; many_of(&amp;doctype/1)</code></pre>

        </section>
      

      
        <section id="summary" class="details-list">
          <h1 class="section-heading">
            <a class="hover-link" href="#summary">
              <i class="icon-link"></i>
            </a>
            Summary
          </h1>
          

          
  <div class="summary-functions summary">
    <h2>
      <a href="#functions">Functions</a>
    </h2>
    <div class="summary-row">
  <div class="summary-signature">
    <a href="#append/2">append(state, expr)</a>
  </div>
  
    <div class="summary-synopsis"><p>Like <a href="#eat/4"><code class="inline">eat/4</code></a>, but instead of creating a token, it appends to the last token</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#convert_positions/2">convert_positions(doc, source)</a>
  </div>
  
    <div class="summary-synopsis"><p>Converts numeric positions into <code class="inline">{line, col}</code> tuples</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#discard/3">discard(state, expr, token_name)</a>
  </div>
  
    <div class="summary-synopsis"><p>Consumes a token, but doesn’t push it to the State</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#eat/2">eat(state, expr)</a>
  </div>
  
    <div class="summary-synopsis"><p>Consumes a token</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#eat/3">eat(state, expr, token_name)</a>
  </div>
  
    <div class="summary-synopsis"><p>Consumes a token</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#eat/4">eat(state, expr, token_name, fun)</a>
  </div>
  
    <div class="summary-synopsis"><p>Consumes a token</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#finalize/1">finalize(state)</a>
  </div>
  
    <div class="summary-synopsis"><p>Turns a State into a final result</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#get_parse_errors/1">get_parse_errors(arg1)</a>
  </div>
  
    <div class="summary-synopsis"><p>Extracts the last parse errors that happened</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#many_of/2">many_of(state, head)</a>
  </div>
  
    <div class="summary-synopsis"><p>Checks many of a certain token</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#many_of/3">many_of(state, head, tail)</a>
  </div>
  
    <div class="summary-synopsis"><p>Checks many of a certain token, and lets you provide a different <code class="inline">tail</code></p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#one_of/3">one_of(state, funs, expected \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Finds any one of the given token-eater functions</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#optional/2">optional(state, fun)</a>
  </div>
  
    <div class="summary-synopsis"><p>An optional argument</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#optional_many_of/2">optional_many_of(state, head)</a>
  </div>
  
    <div class="summary-synopsis"><p>Checks many of a certain token</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#run/3">run(source, opts, fun)</a>
  </div>
  
    <div class="summary-synopsis"><p>Runs; catches parse errors and throws them properly</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#scrub_parse_errors/1">scrub_parse_errors(doc)</a>
  </div>
  
    <div class="summary-synopsis"><p>Gets rid of the <code class="inline">:parse_error</code> hints in the document</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#start_empty/2">start_empty(state, token_name)</a>
  </div>
  
    <div class="summary-synopsis"><p>Creates an token with a given <code class="inline">token_name</code></p>
</div>
  
</div>

  </div>


          

          

        </section>
      

      

      
        <section id="functions" class="details-list">
          <h1 class="section-heading">
            <a class="hover-link" href="#functions">
              <i class="icon-link"></i>
            </a>
            Functions
          </h1>
          <div class="detail" id="append/2">
  <div class="detail-header">
    <a href="#append/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">append(state, expr)</span>
      
      <a href="https://github.com/rstacruz/expug/blob/v0.4.0/lib/expug/tokenizer_tools.ex#L295" class="view-source" rel="help" title="View Source">
       <i class="icon-code"></i>
     </a>
    
  </div>
  
  <section class="docstring">
    <p>Like <a href="#eat/4"><code class="inline">eat/4</code></a>, but instead of creating a token, it appends to the last token.</p>
<p>Useful alongside <code class="inline">start_empty()</code>.</p>
<pre><code class="elixir">state
|&gt; start_empty(:quoted_string)
|&gt; append(~r/^&quot;/)
|&gt; append(~r/[^&quot;]+/)
|&gt; append(~r/^&quot;/)</code></pre>

  </section>
</div>
<div class="detail" id="convert_positions/2">
  <div class="detail-header">
    <a href="#convert_positions/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">convert_positions(doc, source)</span>
      
      <a href="https://github.com/rstacruz/expug/blob/v0.4.0/lib/expug/tokenizer_tools.ex#L322" class="view-source" rel="help" title="View Source">
       <i class="icon-code"></i>
     </a>
    
  </div>
  
  <section class="docstring">
    <p>Converts numeric positions into <code class="inline">{line, col}</code> tuples.</p>
<pre><code class="iex elixir">iex&gt; source = &quot;div\n  body&quot;
iex&gt; doc = [
...&gt;   { 0, :indent, &quot;&quot; },
...&gt;   { 0, :element_name, &quot;div&quot; },
...&gt;   { 4, :indent, &quot;  &quot; },
...&gt;   { 6, :element_name, &quot;body&quot; }
...&gt; ]
iex&gt; Expug.TokenizerTools.convert_positions(doc, source)
[
  { {1, 1}, :indent, &quot;&quot; },
  { {1, 1}, :element_name, &quot;div&quot; },
  { {2, 1}, :indent, &quot;  &quot; },
  { {2, 3}, :element_name, &quot;body&quot; }
]</code></pre>

  </section>
</div>
<div class="detail" id="discard/3">
  <div class="detail-header">
    <a href="#discard/3" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">discard(state, expr, token_name)</span>
      
      <a href="https://github.com/rstacruz/expug/blob/v0.4.0/lib/expug/tokenizer_tools.ex#L220" class="view-source" rel="help" title="View Source">
       <i class="icon-code"></i>
     </a>
    
  </div>
  
  <section class="docstring">
    <p>Consumes a token, but doesn’t push it to the State.</p>
<pre><code class="elixir">state
|&gt; eat(~r/[a-z]+/, :key)
|&gt; discard(~r/ *= */, :equal)
|&gt; eat(~r/[a-z]+/, :value)</code></pre>

  </section>
</div>
<div class="detail" id="eat/2">
  <div class="detail-header">
    <a href="#eat/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">eat(state, expr)</span>
      
      <a href="https://github.com/rstacruz/expug/blob/v0.4.0/lib/expug/tokenizer_tools.ex#L196" class="view-source" rel="help" title="View Source">
       <i class="icon-code"></i>
     </a>
    
  </div>
  
  <section class="docstring">
    <p>Consumes a token.</p>
<p>See <a href="#eat/4"><code class="inline">eat/4</code></a>.</p>

  </section>
</div>
<div class="detail" id="eat/3">
  <div class="detail-header">
    <a href="#eat/3" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">eat(state, expr, token_name)</span>
      
      <a href="https://github.com/rstacruz/expug/blob/v0.4.0/lib/expug/tokenizer_tools.ex#L208" class="view-source" rel="help" title="View Source">
       <i class="icon-code"></i>
     </a>
    
  </div>
  
  <section class="docstring">
    <p>Consumes a token.</p>
<pre><code class="elixir">state
|&gt; eat(~r/[a-z]+/, :key)
|&gt; discard(~r/ *= */, :equal)
|&gt; eat(~r/[a-z]+/, :value)</code></pre>

  </section>
</div>
<div class="detail" id="eat/4">
  <div class="detail-header">
    <a href="#eat/4" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">eat(state, expr, token_name, fun)</span>
      
      <a href="https://github.com/rstacruz/expug/blob/v0.4.0/lib/expug/tokenizer_tools.ex#L253" class="view-source" rel="help" title="View Source">
       <i class="icon-code"></i>
     </a>
    
  </div>
  
  <section class="docstring">
    <p>Consumes a token.</p>
<pre><code class="elixir">eat state, ~r/.../, :document</code></pre>
<p>Returns a <code class="inline">State</code>. Available parameters are:</p>
<ul>
<li><code class="inline">state</code> - assumed to be a state map (given by <a href="#run/3"><code class="inline">run/3</code></a>).
</li>
<li><code class="inline">expr</code> - regexp expression.
</li>
<li><code class="inline">token_name</code> (atom, optional) - token name.
</li>
<li><code class="inline">reducer</code> (function, optional) - a function.
</li>
</ul>
<h2>Reducers</h2>
<p>If <code class="inline">reducer</code> is a function, <code class="inline">tokens</code> is transformed using that function.</p>
<pre><code class="elixir">eat state, ~r/.../, :document, &amp;[{&amp;3, :document, &amp;2} | &amp;1]

# &amp;1 == tokens in current State
# &amp;2 == matched String
# &amp;3 == position</code></pre>
<h2>Also see</h2>
<p><a href="#discard/3"><code class="inline">discard/3</code></a> will consume a token, but not push it to the State.</p>
<pre><code class="elixir">state
|&gt; discard(~r/ +/, :whitespace)  # discard it</code></pre>

  </section>
</div>
<div class="detail" id="finalize/1">
  <div class="detail-header">
    <a href="#finalize/1" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">finalize(state)</span>
      
      <a href="https://github.com/rstacruz/expug/blob/v0.4.0/lib/expug/tokenizer_tools.ex#L72" class="view-source" rel="help" title="View Source">
       <i class="icon-code"></i>
     </a>
    
  </div>
  
  <section class="docstring">
    <p>Turns a State into a final result.</p>
<p>Returns either <code class="inline">{:ok, doc}</code> or <code class="inline">{:parse_error, %{type, position, expected}}</code>.
Guards against unexpected end-of-file.</p>

  </section>
</div>
<div class="detail" id="get_parse_errors/1">
  <div class="detail-header">
    <a href="#get_parse_errors/1" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">get_parse_errors(arg1)</span>
      
      <a href="https://github.com/rstacruz/expug/blob/v0.4.0/lib/expug/tokenizer_tools.ex#L103" class="view-source" rel="help" title="View Source">
       <i class="icon-code"></i>
     </a>
    
  </div>
  
  <section class="docstring">
    <p>Extracts the last parse errors that happened.</p>
<p>In case of failure, <a href="#run/3"><code class="inline">run/3</code></a> will check the last parse errors
that happened. Returns a list of atoms of the expected tokens.</p>

  </section>
</div>
<div class="detail" id="many_of/2">
  <div class="detail-header">
    <a href="#many_of/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">many_of(state, head)</span>
      
      <a href="https://github.com/rstacruz/expug/blob/v0.4.0/lib/expug/tokenizer_tools.ex#L162" class="view-source" rel="help" title="View Source">
       <i class="icon-code"></i>
     </a>
    
  </div>
  
  <section class="docstring">
    <p>Checks many of a certain token.</p>

  </section>
</div>
<div class="detail" id="many_of/3">
  <div class="detail-header">
    <a href="#many_of/3" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">many_of(state, head, tail)</span>
      
      <a href="https://github.com/rstacruz/expug/blob/v0.4.0/lib/expug/tokenizer_tools.ex#L169" class="view-source" rel="help" title="View Source">
       <i class="icon-code"></i>
     </a>
    
  </div>
  
  <section class="docstring">
    <p>Checks many of a certain token, and lets you provide a different <code class="inline">tail</code>.</p>

  </section>
</div>
<div class="detail" id="one_of/3">
  <div class="detail-header">
    <a href="#one_of/3" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">one_of(state, funs, expected \\ [])</span>
      
      <a href="https://github.com/rstacruz/expug/blob/v0.4.0/lib/expug/tokenizer_tools.ex#L125" class="view-source" rel="help" title="View Source">
       <i class="icon-code"></i>
     </a>
    
  </div>
  
  <section class="docstring">
    <p>Finds any one of the given token-eater functions.</p>
<pre><code class="elixir">state |&gt; one_of([ &amp;brackets/1, &amp;braces/1, &amp;parens/1 ])</code></pre>

  </section>
</div>
<div class="detail" id="optional/2">
  <div class="detail-header">
    <a href="#optional/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">optional(state, fun)</span>
      
      <a href="https://github.com/rstacruz/expug/blob/v0.4.0/lib/expug/tokenizer_tools.ex#L143" class="view-source" rel="help" title="View Source">
       <i class="icon-code"></i>
     </a>
    
  </div>
  
  <section class="docstring">
    <p>An optional argument.</p>
<pre><code class="elixir">state |&gt; optional(&amp;text/1)</code></pre>

  </section>
</div>
<div class="detail" id="optional_many_of/2">
  <div class="detail-header">
    <a href="#optional_many_of/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">optional_many_of(state, head)</span>
      
      <a href="https://github.com/rstacruz/expug/blob/v0.4.0/lib/expug/tokenizer_tools.ex#L186" class="view-source" rel="help" title="View Source">
       <i class="icon-code"></i>
     </a>
    
  </div>
  
  <section class="docstring">
    <p>Checks many of a certain token.</p>
<p>Syntactic sugar for <code class="inline">optional(s, many_of(s, ...))</code>.</p>

  </section>
</div>
<div class="detail" id="run/3">
  <div class="detail-header">
    <a href="#run/3" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">run(source, opts, fun)</span>
      
      <a href="https://github.com/rstacruz/expug/blob/v0.4.0/lib/expug/tokenizer_tools.ex#L86" class="view-source" rel="help" title="View Source">
       <i class="icon-code"></i>
     </a>
    
  </div>
  
  <section class="docstring">
    <p>Runs; catches parse errors and throws them properly.</p>

  </section>
</div>
<div class="detail" id="scrub_parse_errors/1">
  <div class="detail-header">
    <a href="#scrub_parse_errors/1" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">scrub_parse_errors(doc)</span>
      
      <a href="https://github.com/rstacruz/expug/blob/v0.4.0/lib/expug/tokenizer_tools.ex#L114" class="view-source" rel="help" title="View Source">
       <i class="icon-code"></i>
     </a>
    
  </div>
  
  <section class="docstring">
    <p>Gets rid of the <code class="inline">:parse_error</code> hints in the document.</p>

  </section>
</div>
<div class="detail" id="start_empty/2">
  <div class="detail-header">
    <a href="#start_empty/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">start_empty(state, token_name)</span>
      
      <a href="https://github.com/rstacruz/expug/blob/v0.4.0/lib/expug/tokenizer_tools.ex#L278" class="view-source" rel="help" title="View Source">
       <i class="icon-code"></i>
     </a>
    
  </div>
  
  <section class="docstring">
    <p>Creates an token with a given <code class="inline">token_name</code>.</p>
<p>This is functionally the same as <code class="inline">|&gt; eat(~r//, :token_name)</code>, but using
<code class="inline">start_empty()</code> can make your code more readable.</p>
<pre><code class="elixir">state
|&gt; start_empty(:quoted_string)
|&gt; append(~r/^&quot;/)
|&gt; append(~r/[^&quot;]+/)
|&gt; append(~r/^&quot;/)</code></pre>

  </section>
</div>

        </section>
      

      

      
        <footer class="footer">
      <p>
        <span class="line">
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" rel="help" target="_blank">ExDoc</a> (v0.11.5),
        </span>
        <span class="line">
          designed by
          <a href="https://twitter.com/dignifiedquire" target="_blank" title="@dignifiedquire">Friedel Ziegelmayer</a>.
          </span>
      </p>
      <button class="night-mode-toggle" />
    </footer>
  </div>
</section>
</div>
  <script src="dist/app-918614602f.js"></script>
  </body>
</html>

